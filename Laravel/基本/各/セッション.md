# セッション


## セッションを利用したデータの保存

リクエストからセッションを取得し、セッションのメソッドで操作する

セッションの取得
`$request->session()`

| メソッド                   | - |
| -------------------------- | - |
| all()                      | 全て取得 |
| has(キー)                  | bool キーが存在し、nullでない |
| exists(キー)               | bool キーが存在する |
| get(キー[, デフォルト値])  | 取得 |
| pull(キー[, デフォルト値]) | 取得してセッションから削除 |
| put(キー, 値)              | 保存 |
| flush(キー, 値)            | 次のリクエストまでだけ持続する保存 |
| reflush()                  | 前回からのフラッシュをさらに次まで持続 |
| keep(キーの配列)           | 指定したキーのみ再フラッシュ |
デフォルト値は関数も渡せる
forget(キーまたは配列)|指定したキーを削除
flush()|全てのキーを削除
regenerate()|セッションIDの再生成

セッションIDの再生成はデフォルトでやってくれるので必要な場合のみ

## セッションをデータベースで管理する

特に設定を行わずに行えば、セッションで操作されるデータは`storage/framework/sessions`内のファイルとして保管される、セッションごとの無数のファイルが生成され続けることになる

処理の安定のためにデータベースを利用するよう変更する
使用するキーや型を十分設計しようね

### データベースを利用する設定に変更する

`config/session.php`で設定を記述する連想配列を編集する

```php
'driver' => env('SESSION_DRIVER', 'database'),
```

全体の環境設定である`.env`ファイル内を編集する

```
SESSION_DRIVER=database
```

### セッション用のテーブルを作成してマイグレーション

セッション用のマイグレーションファイルを生成する
`php artisan session:table`
通常のデータベースと同じくmigrationsに`xxx_session_table.php`が追加される

初期状態でよい。

`php artisan migrate`

テーブルが生成されてめでたしめでたし
