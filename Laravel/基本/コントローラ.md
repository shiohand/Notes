# コントローラ

## MVCのController
PHPのスクリプトファイルとして作成
ModelやViewを呼び出して全体の制御を行う

## コントローラの作成
* 直接ファイルを作成する
* artisanコマンドを使って作成する
* アクション(後述)を追加
* ルーティングにコントローラを登録できる

### artisanコマンドを使って作成
artisanコマンド - `php artisan [コマンド]`
1. アプリケーションフォルダに移動
2. `php artisan make:controller [コントローラ名]`
3. 成功すれば`Controller created successfully.`の表示
4. app/Http/Controllers に コントローラ名.phpが作成されている

## コントローラの内容
* 初期内容
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class HelloController extends Controller
{
    //
}
```

### Controllers名前空間
```php
namespace App\Http\Controllers;
```
フォルダの配置に即した名前空間

### useによるRequestクラスのインポート
```php
use Illuminate\Http\Request;
```
多用するクラスなため、デフォルトでインポートされている

### Controllerクラス
```php
class HelloController extends Controller {}
```
コントローラはクラスとして作成され、Controllerクラスextendsしている

## アクションを追加
* アクション = コントローラに追加する処理
* メソッドの形で複数用意できる

## 基本のアクション
```php
public function index() {
  return <<<EOF
  <h1>Index</h1>
  <p>Helloコントローラのindexアクション</p>
  EOF;
}
```
* returnした内容が表示される

### view(テンプレート名)
テンプレートファイル、`resource/views/[テンプレート名].拡張子`をレンダリングしたデータを含めたResponseインスタンスを返す
returnするだけでページが表示されるが、レンダリング結果だけが返っているのではないので混乱注意

ドット区切りでフォルダ指定を指定する
```php
return view('welcome');
// -> resource/views/welcome.拡張子
return view('hello.index');
// -> resource/views/hello/index.拡張子
```

### 直HTML文字列でも表示できるよ
```php
return '<html><body><h1>Hello</h1><p>This is sample page.</p></body></html>';
```

### ルートパラメータの利用
* ファイルが分かれただけで、ルーティングで関数を渡すのと同じ
```php
/* web.php */
Route::get('/hello/{id?}/{pass?}', 'HelloController@index');
```
```php
/* HelloController.php */
public function index($id='noname', $pass='unknown') {
  return <<<EOF
  <h1>Index</h1>
  <p>Helloコントローラのindexアクション</p>
  <ul>
    <li>ID: {$id}</li>
    <li>PASS: {$pass}</li>
  </ul>
  EOF;
}
```

### シングルアクションコントローラ
* 使用するアクションを一つに決めたコントローラ
<<<<<<< HEAD
\- メソッドの追加はできるがアクションとして機能しない
=======
メソッドの追加はできるがアクションとして機能しない
>>>>>>> 7fbe00f4845d020da0ca62fa0af84c4801460707
* ルーティングでコントローラ名だけいれれば__invokeが実行される

```php
/* HelloController.php */
public function __invoke() {
  return <<<EOF
  <h1>Index</h1>
  <p>Helloコントローラ(シングルアクション)</p>
  EOF;
}
```
* __invoke() アクションを追加

```php
/* web.php */
Route::get('/hello', 'HelloController');
```
* アクションの指定が不要

__invoke()はLaravelではなくPHPのマジックメソッド
クラスのインスタンスを関数のように`inst()`すると、__invoke()メソッドが実行されるようになる機能

## Request と Response
* `Illuminate\Http` 名前空間にある RequestクラスとResponseクラス
* アクションメソッドの引数として、リクエスト情報やレスポンス情報を受け取ることができる

### アクションの引数で受け取る

```php
use Illuminate\Http\Request;
use Illuminate\Http\Response;

/* 省略 */

public function index(Request $request, Response $response) {
  $html = <<<EOF
  <h1>Index</h1>
  <h3>Request</h3>
  <pre>{$request}</pre>
  <h3>Response</h3>
  <pre>{$response}</pre>
  EOF;

  $response->setContent($html);
  return $response;
}
```

Requestの例
```
GET /hello3 HTTP/1.1
Accept:                    text/html...
Accept-Encoding:           gzip, def...
Accept-Language:           ja,en-US;...
...
```
Responseの例
```
HTTP/1.0 200 OK
Cache-Control: no-cache, private
Date:          Fri, 25 Dec 2020 05:33:59 GMT
```

### Requestの主なメソッド
|-          |-
|-          |-
| url()     | クエリ文字列を含まないURL
| fullUrl() | クエリ文字列を含むURL
| path()    | ドメイン下のパス部分

### Responseの主なメソッド
|-             |-
|-             |-
| status()     | 返送する際のステータスコードや表示コンテンツの設定
| content()    | コンテンツの取得
| setContent() | コンテンツを引数の値に変更


