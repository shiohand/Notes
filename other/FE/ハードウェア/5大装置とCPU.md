# 5大装置とCPU - ハードウェア

- [5大装置](#5大装置)
- [クロック周波数](#クロック周波数)
- [CPU](#cpu)
  - [レジスタ](#レジスタ)
- [命令実行サイクル](#命令実行サイクル)
  - [アドレス指定(アドレス修飾)](#アドレス指定アドレス修飾)
- [CPU高速化](#cpu高速化)
  - [逐次制御方式](#逐次制御方式)
  - [パイプライン処理](#パイプライン処理)
    - [スーパーパイプライン処理](#スーパーパイプライン処理)
    - [スーパースカラ](#スーパースカラ)
  - [CISCとRISC](#ciscとrisc)
  - [マルチコアプロセッサ](#マルチコアプロセッサ)
  - [GPU](#gpu)
- [問題](#問題)
  - [Q. レジスタ](#q-レジスタ)
  - [Q. アドレス指定](#q-アドレス指定)
  - [Q. クロック周波数](#q-クロック周波数)

## 5大装置

1. CPU **制御装置**
\- 記憶装置から取り出した命令を解読、各装置に指示
2. CPU **演算装置** (ALU : Arithmetic and Logic Unit)
\- データ処理や加工 四則演算・論理演算
3. **記憶装置**
\- データやプログラムの記憶
4. **入力装置**
\- データを外部から読み込み
5. **出力装置**
\- データを外部へ書き出し

* プログラム内蔵方式
  一般的なコンピュータで採用
  プログラムを主記憶装置上に読み込んで、CPUが順に読み出しながら実行

## クロック周波数

クロック数 / 秒
クロック信号を生成する電圧の高低のサイクルの1秒あたりの数

* 1GHz
\- 1 秒 = 10^9 回
\- 1 回 = 1 / 10^9 = 0.000_000_001 秒
\- 1 回 = 1 * 10^(-9) = 1 ナノ秒 でもよし

**メモリやドライブの性能が同じであれば**、周波数が高い方が命令実行速度は向上する

* 外部クロック
\- CPU と 主記憶 を繋ぐシステムバスのクロック
* 内部クロック
\- CPU内部のクロック 外部クロックの数倍
\- PCのスペックとして表示されるほう

## CPU

CPU : 中央処理装置

### レジスタ

CPU内の高速な記憶装置

* **命令レジスタ**
\- 取り出された命令を格納
* **命令アドレスレジスタ (プログラムカウンタ)**
\- 実行すべき命令が格納されているアドレスを保持
* **インデックスレジスタ (指標レジスタ)**
\- アドレス指定で 増分値 を保持
* **ベースレジスタ (基底レジスタ)**
\- アドレス指定で 基準となるアドレス値 を保持
* **アキュムレータ (累算器)**
\- 被演算数・演算結果を一時的に保持
* **汎用レジスタ**
\- なんでもやさん

## 命令実行サイクル

* 命令語 = 命令部 + アドレス部(オペランド部)
\- 機械語
\- 命令部だけのもの、アドレス部が複数あるものもある

(制御装置)
主記憶装置(メモリ)に格納されている命令を読み出し
解読
各装置に指示
(演算装置)
データに対する演算

1. 命令フェッチ(命令取り出し)

   **命令アドレスレジスタ**「命令のアドレスはこちら。さて次の準備をば……」
   **メモリ**「承りました。このアドレスにいるのは、ええと、きみか」
   中身(命令)「いってやらあ」
   **命令レジスタ**「メモリから命令ふぇっち！　格納！」

2. 命令の解読

   **命令レジスタ**「命令部おなしゃす解読器さん！　アドレス部はアドレスレジスタさん！」
   **解読器(命令デコーダ)**「演算命令はいやだ演算命令はいやだ(演算装置に指示するのめんどい)」
   **アドレスレジスタ**「即値がいいな(計算がいらないので)」

3. 実効アドレス計算 = アドレス指定(アドレス修飾)

   **アドレスレジスタ**「わざわざ計算して見つけだしてあげたアドレスがこちらになります」
   **メモリ**「承りました(足し算程度で恩着せがましいな)」

4. オペランド読出し

   **メモリ**「このアドレスは、きみだな。演算装置へ」
   中身(データ)「いってやらあ」
   **演算装置**「ひえぇ(データこわい)」

5. 命令の実行

   **演算装置**「仕事は孤独に限る！」

6. 演算結果格納

   **演算装置**「あ、その、コケッコ(噛んじゃった)」
   **メモリ**「結果ですね。承りました」

### アドレス指定(アドレス修飾)

命令レジスタから受け取った値から、答え(実効アドレス)を導く
そのまま渡すか足し算して渡すかだけ

**アドレスレジスタ**「即値がいいのに」

* **即値アドレス指定**
\- 「これ実効アドレスじゃなくて値だラッキー」
\- データのあるアドレスではなく、値がデータだったパターン
* **直接アドレス指定**
\- 「これ自体が答えだラッキー」
\- 実効アドレス
* **間接アドレス指定**
\- 「ここに答え書いてるらしいよ。いくつか辿らなきゃいけないかもだけど。ポイー」
\- 実効アドレスへの参照アドレス。行ってみたらそこも参照アドレスだったってこともある。
* **インデックス(指標)アドレス指定**
\- 「計算(足し算)だ」 インデックスレジスタ「今の値教えるから早くきなよ」
\- 値にインデックスレジスタの値を足す
\- 実効アドレスを次のアドレス部に使い回せば150ずつ進める、とかできるのが利点
* **ベース(基底)アドレス指定**
\- 「計算だ。ベースレジスタが来い」 ベースレジスタ「お前が来い」
\- 値にベースレジスタの値を足す
\- データをごっそり移動したときは、ベースレジスタの値を変えれば一つ一つのアドレスは変えなくていいからお得 = **再配置可能(リロケータブル)** ということ
* **相対(自己相対)アドレス指定**
\- 「命令アドレスレジスタって楽そうでいいな」 命令アドレスレジスタ「凍らすぞ」
\- 値に命令アドレスレジスタの値を足す
\- 便利ポイントあるんやろうけどテキストに書いてない

## CPU高速化

### 逐次制御方式

* 命令サイクルを1命令ずつ順番に実行

```
1-2-3-4-5-6-7
             1-2-3-4-5-6-7
```

### パイプライン処理

* 命令サイクルの段階ごとにずらして実行
* 終わってない部分は予測して進めている = **分岐予測** **投機実行**
* 分岐命令があると予測した分がやりなおしになる = **パイプラインハザード(分岐ハザード)**

```
1-2-3-4-5-6-7
  1-2-3-4-5-6-7
```

#### スーパーパイプライン処理

* もっとこまかく

```
1-2-3-4-5-6-7
 1-2-3-4-5-6-7
```

#### スーパースカラ

* 二重にしちゃう
\- 「スカラ」に多重っぽさを感じて覚えてほしい

```
1-2-3-4-5-6-7
1-2-3-4-5-6-7
  1-2-3-4-5-6-7
  1-2-3-4-5-6-7
```

### CISCとRISC

CPUのアーキテクチャ
CISC (Complex Instruction Set Computer)
RISC (Reduced Instruction Set Computer)

| -    | 特徴     | 利用例       |
| ---- | -------- | ------------ |
| CISC | にぶ賢い | PCなど       |
| RISC | バカ速い | 組み込みなど |

### マルチコアプロセッサ

一つのCPUに複数のコアを備え、並行処理が可能に
消費電力を抑えながら処理速度は高速化

### GPU

3Dの画像処理を高速に実行 最近はCPUに内蔵

## 問題

### Q. レジスタ

プログラムレジスタ(プログラムカウンタ)の役割は何か
<details><summary>A.</summary>

実行すべき命令が格納されたアドレスを保持
</details>

### Q. アドレス指定

インデックスレジスタの値 : 10
命令後のアドレス部の値 : 100
命令が格納されているアドレス : 1000

上のとき、インデックス修飾によってオペランドを指定する場合の実効アドレスは
<details><summary>A.</summary>

アドレス部 + インデックスレジスタ = 実効アドレス
10 + 100 = 110

※ 命令が格納されているアドレス は、命令をとってきたときに使っただけなので関係ない
</details>

### Q. クロック周波数

CPUのクロック周波数と、主記憶を接続するシステムバスのクロック周波数は同一でなくてもよい？
<details><summary>A.</summary>

よいよい。CPUの=内部クロック、システムバスの=外部クロック
</details>