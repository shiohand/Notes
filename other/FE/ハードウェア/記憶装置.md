# 記憶装置 - ハードウェア

- [RAMとROM](#ramとrom)
  - [RAM (Random Access Memory)](#ram-random-access-memory)
  - [ROM (Read Only Memory)](#rom-read-only-memory)
- [メモリ効率](#メモリ効率)
  - [キャッシュメモリ](#キャッシュメモリ)
  - [実効アクセス時間](#実効アクセス時間)
  - [記憶装置のアクセス速度の差](#記憶装置のアクセス速度の差)
  - [メモリインタリーブ](#メモリインタリーブ)
- [問題](#問題)
  - [Q. 実効アクセス時間](#q-実効アクセス時間)
  - [Q. 実効アクセス時間](#q-実効アクセス時間-1)
- [補助記憶装置](#補助記憶装置)
  - [磁気ディスク装置](#磁気ディスク装置)
    - [アクセス時間](#アクセス時間)
      - [アクセス時間の計算](#アクセス時間の計算)
  - [フラグメンテーション](#フラグメンテーション)
- [問題](#問題-1)
  - [Q. アクセス時間の計算](#q-アクセス時間の計算)
  - [Q. アクセス時間の計算2](#q-アクセス時間の計算2)

## RAMとROM

| -   | -           | -      |
| --- | ----------- | ------ |
| RAM | read, write | 揮発   |
| ROM | read        | 不揮発 |

### RAM (Random Access Memory)

| -    | -                          | 特徴       | 用途             |
| ---- | -------------------------- | ---------- | ---------------- |
| DRAM | コンデンサ(要リフレッシュ) | 多・遅・安 | 主記憶装置       |
| SRAM | フリップフロップ           | 少・速・高 | キャッシュメモリ |

DRAM (dynamic)
SRAM (static)

### ROM (Read Only Memory)

* マスクROM
\- 製造時に書き込んだ内容で固定
* PROM
\- 消去と書き換えが可能
  * EPROM
  \- **UV**で全消可能
    * EPPROM
    \- 電圧で**バイト単位**消去可能
      * フラッシュメモリ
      \- 電圧で全消・**ブロックで部分消去や書き換え**可能

## メモリ効率

### キャッシュメモリ

CPUの処理速度に対し、メモリへのアクセス速度は遅い
-> 小容量・高速なキャッシュメモリを間に挟む
-> 繰り返し使うようなデータはキャッシュメモリが覚えておく

* 1次キャッシュと2次キャッシュ
\- CPUがくそ速いとかで主記憶装置との速度差が大きいときは2次キャッシュを導入する場合も
\- L1キャッシュ、L2キャッシュとも呼ばれる

* ライトスルー方式とライトバック方式
\- キャッシュメモリにデータの書き込み命令があったとき...
\- ライトスルー -> メインメモリも書き換える
\- ライトバック -> メインメモリは**あとで**書き換える

* ディスクキャッシュ
\- 主記憶装置と低速の補助記憶装置(HDDとか)の間にキャッシュを入れる
\- メモリの一部を割り当ててたり、HDD側に内蔵してたり
\- 磁気ディスク向け。SSDとかUSBメモリとかでやっても対して変わらん

### 実効アクセス時間

キャッシュメモリを使った実効アクセス時間
```
ヒット率 * キャッシュメモリのアクセス時間 + (1 - ヒット率) * メインメモリのアクセス時間
```

### 記憶装置のアクセス速度の差

レジスタ > キャッシュ > 主記憶 > ディスクキャッシュ > HDDなど磁気ディスク

### メモリインタリーブ

主記憶の中に並行動作できるように区画を作って使う
大容量一つより半分ずつを二つのほうが速いみたいな

## 問題

### Q. 実効アクセス時間

ヒット率 : 80%
キャッシュメモリのアクセス時間 : 10ナノ秒
主記憶装置のアクセス時間 : 60ナノ秒
のときの実効アクセス時間は
<details><summary>A.</summary>

((0.8) * 10) + ((0.2) * 60) = 20
</details>

### Q. 実効アクセス時間

AからDまでを実効アクセス時間の短い順に並べよ
(ナノ秒)
|   -   | ヒット率 |   キ |   主 |
| :---: | -------: | ---: | ---: |
|   A   |        - |    - |   15 |
|   B   |        - |    - |   30 |
|   C   |      60% |   20 |   70 |
|   D   |      90% |   10 |   80 |

<details><summary>A.</summary>

A:15
B:30
C:0.6 * 20 + 0.4 * 70 = 40
D:0.9 * 10 + 0.1 * 80 = 17

A > D > B > C
</details>

## 補助記憶装置

* 光ディスク
  * CD ~700MB
  * DVD ~17GB
  * BD ~128GB
* フラッシュメモリ
  * SD ~2GB
    * SDHC ~32GB
    * SDXC ~2TB exFAT
* SSD (Solid State Drive)
* 磁気ディスク装置・HDD

### 磁気ディスク装置

* セクタ方式
\- セクタ(1区画) -> トラック(1周) -> シリンダ(1面)
\- セクタ単位でデータを読み書き
\- 一つのデータに複数セクタを使うことはあるが、一つのセクタに複数のデータが入ることはない

セクタ長が512Bのディスクに1,000Bのデータを書き込んだ場合
-> 512 + 488 = 1,000 で2区画を使用 ふたつめの残った 54 には何も記録されないことになる

#### アクセス時間

* 位置決め時間 (シーク時間)
\- 磁気ヘッドを目的のトラックまで移動させるのにかかる時間
* 回転待ち時間 (サーチ時間)
\- データ開始位置が磁気ヘッドの位置に回ってくるのを待つ時間
\- 一周するのにかかる時間 * 1/2 が平均回転待ち時間になる
* データ転送時間
\- データ開始位置から終了位置まで回るのにかかる時間

##### アクセス時間の計算

\- `アクセス時間 = 位置決め時間 + 回転待ち時間 + データ転送時間`

### フラグメンテーション

ファイルの書き込みや削除を繰り返して、まとまった空き領域がなくなり、
ファイルを分散して書き込んでいくようになるなどしてデータが**断片化**すること

アクセス速度の低下
-> 最適化ソフト(デフラグメンテーション、オプティマイザー)などを使用して再配置

## 問題

### Q. アクセス時間の計算

回転数 : 4,200 回 / 分
平均位置決め時間 : 5 ミリ秒

の磁気ディスク装置の平均待ち時間は 何ミリ秒 か
平均待ち時間は 平均位置決め時間と平均回転待ち時間の合計とする

<details><summary>A.</summary>

平均待ち時間 = 5 ミリ秒 + 平均回転待ち時間

回転数 = 4200 回 / 60 * 10^3 ミリ秒
平均回転待ち時間 = 1回分の時間 / 2 = 60,000 / 4200 / 2 = 50 / 7 = 7...1
平均待ち時間 = 5 ミリ秒 + 約 7 ミリ秒 = 約 12 ミリ秒
</details>

### Q. アクセス時間の計算2

回転数 : 6,000 回 / 分
平均位置決め時間 : 20 ミリ秒
1トラックあたりの記憶容量 : 20 kB

の磁気ディスク装置で
1ブロックが4kバイトのデータを1ブロック転送するのにかかる平均アクセス時間は 何ミリ秒 か
1 kB = 1,000 B とする
<details><summary>A.</summary>

平均アクセス時間 = 20 ミリ秒 + 平均回転待ち時間 + 転送時間

平均回転待ち時間 = 60 * 10^3 / 6000 / 2 = 5

転送時間 = 読み込むトラック数 * 一回転の時間
 = 4 k / 20 k * 10
 = 1 / 5 * 10
 = 2 ミリ秒

平均アクセス時間 = 20 + 5 + 2 = 27 ミリ秒
</details>