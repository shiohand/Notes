# 基本ソフトウェアの機能

- [ジョブ管理とタスク管理](#ジョブ管理とタスク管理)
  - [ジョブ管理](#ジョブ管理)
  - [タスク管理](#タスク管理)
    - [タスクの状態遷移](#タスクの状態遷移)
    - [タスクスケジューリング](#タスクスケジューリング)
    - [割り込み処理](#割り込み処理)
- [問題](#問題)
  - [Q. マルチタスク](#q-マルチタスク)
  - [記憶管理](#記憶管理)

## ジョブ管理とタスク管理
ジョブ : 利用者が目線の仕事の単位
タスク : コンピュータ目線の仕事の単位

### ジョブ管理
ジョブの実行スケジュールをOSが管理

**ジョブ制御言語 (JCL : Job Control Language)**で記述

1. 利用者 -> 依頼
2. **マスタスケジューラ**(管理プログラム) -> 依頼
3. **ジョブスケジューラ** -> 実行
   * **リーダ** - <small>読み込みの感じ</small>
   \- ジョブを入力、登録 (ジョブ待ち)
   * **イニシエータ** - <small>イニシエーションの感じ</small>
   \- 優先度の高いジョブから ジョブステップ(実行単位) に分割
   * **ターミネータ** - <small>ターミナルへ送り出す感じたぶん</small>
   \- 結果を登録 (出力待ち)
   * **ライタ** - <small>書き出しの感じ</small>
   \- 優先度の高いものから順に出力

### タスク管理

* **マルチプログラミング(マルチタスク)**
\- CPUの入出力待ち(逆もあり)である遊休時間(アイドルタイム)に他のタスクを進めることで擬似マルチコア
* **ディスパッチ**
\- 実行可能状態のタスクの中から、次に実行すべきタスクにCPU使用権を与える
* **ディスパッチャ**
\- ディスパッチを行うプログラム

#### タスクの状態遷移

(タスク発生) -> 実行可能状態

1. **実行可能状態(Ready)**
\- 実行待ち -> 実行状態
2. **実行状態(Run)**
\- 実行中 -> 実行可能状態 or 待ち状態 or (タスク完了)
3. **待ち状態(Wait)**
\- 入出力待ち -> 実行可能状態

実行状態 と 実行可能状態 の間でだけ行き来が発生することがある

#### タスクスケジューリング

CPU使用権を与える順序を定める

* **到着順方式**
\- 並んだ順
\- 実行状態に入ったら中断はない(**ノンプリエンプション**)
* **優先(プライオリティ)順方式**
\- タスクに設定した優先度の高い順
\- 実行状態にあっても、待ち行列により優先度の高いタスクがあれば交代する(**プリエンプション**)
* **ラウンドロビン方式**
\- 並んだ順だが、一定時間ごとに交代し、実行状態だったタスクは最後尾に並び直す

#### 割り込み処理

割り込みが発生した場合は、次にするはずだった命令アドレスは一時的に退避される

* 内部割込み
  * プログラム割込み
  \- 不正処理, 例外処理
  * SVC(Super Visor Call)割込み
  \- 入出力の要求など、カーネル(スーパーバイザ)呼び出し命令による割込み
* 外部割込み
  * 入出力割込み
  \- 入出力装置の動作完了や中断
  * 機械チェック割込み
  \- ハードウェアの異常など
  * コンソール割込み
  \- オペレータ(利用者)による介入
  * タイマ割込み
  \- 規定の時間を超過したとき

## 問題

### Q. マルチタスク

3つのタスクの優先度、動作順序、処理時間が次のようであるとき、
すべてのタスクが完了するまでに発生したCPUの遊休時間は 何ミリ秒 か

| 優先度 | 単独実行時の動作順序と処理時間(ミリ秒) |
| :----: | -------------------------------------- |
|   高   | CPU(3) -> I/O(5) -> CPU(2)             |
|   中   | CPU(2) -> I/O(6) -> CPU(2)             |
|   低   | CPU(1) -> I/O(5) -> CPU(1)             |

<details><summary>A.</summary>

```
1 CCCIIIIICC----
2 ---CCIIIIIICC-
3 -----CIIIII--C

A ______--__-___ 3 ミリ秒

```
</details>

### 記憶管理

プログラム記憶方式
フラグメンテーション メモリリーク
ガーベジコレクション(メモリコンパクション)
実記憶管理 : 固定区画方式, 可変区画方式, オーバーレイ方式(実行に必要な部分だけ)
仮想記憶管理 : ページング方式
実際使う段になったら動的アドレス変換機構(DAT : Dynamic Address Translator)でアドレス変換

ページング(スワッピング) : ページインとページアウト
ページフォルト : 主記憶上にページがないときの割込み
スラッシング : ページのやりとりが増えすぎて処理が低下

ページ置き換えアルゴリズム
FIFO (First-In First-Out)
LRU (Least Recentry Used)
LFU (Least Frequently Used)